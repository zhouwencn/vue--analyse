<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="../vue.js"></script>
  </head>
  <style>
    .sub_child::after {
      content: attr(data-content);
      background-color: rgb(255, 255, 255);
    }
  </style>
  <body>
    <div id="app">
      <child :msg="msg" :parent="parent"></child>
    </div>
    <script>
      // 孙组件
      const sub_child = {
        props: {
          sub: String
        },
        render(h) {
          return h(
            'div',
            {
              class: 'sub_child',
              on: {
                click: this.clickHandler
              },
              // 如果组件是其它组件的子组件，需为插槽指定名称
              slot: 'sub_child_slot'
            },
            [
              h('div', this.sub),
              h('slot', {
                name: 'header'
              })
            ]
          )
        },
        methods: {
          clickHandler() {
            alert('孙组件')
          }
        }
      }
      // 子组件
      const child = {
        components: {
          sub_child
        },
        props: {
          parent: String
        },
        data() {
          return {
            child: '子组件'
          }
        },
        render(h) {
          return h(
            'div',
            {
              style: {
                backgroundColor: 'red'
              }
            },
            [
              h('h1', this.child),
              // 孙组件
              h(sub_child, {
                // 给孙组件传递attrs
                attrs: {
                  'data-content': 'content'
                },
                // 给孙组件传递props
                props: {
                  sub: '孙组件',
                  text: '作用域插槽'
                },
                // 作用域插槽的格式为
                // { name: props => VNode | Array<VNode> }
                scopedSlots: {
                  header: () => h('h1', 'test')
                }
              }),
              // 子组件没用props接收的，就会在attrs里面
              h('div', {}, this.$attrs['msg'])
            ]
          )
        }
      }
      // 根组件
      const app = new Vue({
        components: {
          child
        },
        data() {
          return {
            msg: 'msg_parent',
            parent: 'parent'
          }
        }
      }).$mount('#app')
    </script>
  </body>
</html>
